permissions:
  contents: write
"on":
  workflow_dispatch:
    inputs:
      value:
        description: value
        required: false
        default: ""
env:
  version: asd
jobs:
  build:
    steps:
    - uses: actions/checkout@v4
      with:
        token: ${{ secrets.RUN_REPO_PAT }}
        persist-credentials: true
    - name: Run a one-line script
      run: echo Hello, world!
    - name: Show value input
      run: echo "Input 'value' = '${{ github.event.inputs.value }}'"
    - shell: pwsh
      name: Set value
      run: |
        Install-Module powershell-yaml -Force -Scope CurrentUser
        .\setValue.ps1 -FilePath .\.github\workflows\self.yml -Key env.version -Value "${{ github.event.inputs.value }}"
        Get-Content .\.github\workflows\self.yml
    - name: Commit changes
      run: |
        git config --global user.name "${{ github.actor }}"
        git config --global user.email "${{ github.actor }}@users.noreply.github.com"

        git add .github/workflows/self.yml
        git diff --cached --quiet || git commit -m "[ci] Update self.yml with new value '${{ github.event.inputs.value }}' (triggered by ${{ github.actor }})"
        git status
        git push origin HEAD:${{ github.ref_name }}
    runs-on: ubuntu-latest
name: CI Self

